<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Демо тест автошколы</title>
  <style>
    :root {
      --primary: #3498db;
      --secondary: #2980b9;
      --success: #27ae60;
      --danger: #e74c3c;
      --info: #3498db;
    }
    body { font-family: sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; position: relative; transition: filter 0.3s, opacity 0.3s; }
    .blur { filter: blur(3px); opacity: 0.5; }
    header { background: var(--primary); color: #fff; padding: 20px 0; text-align: center; margin-bottom: 20px; }
    button { padding: 8px 12px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-success { background: var(--success); color: #fff; }
    .btn-danger { background: var(--danger); color: #fff; }
    .btn-info { background: var(--info); color: #fff; }
    .card { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .mode-selection { text-align: center; margin-bottom: 20px; }
    .question { margin-bottom: 20px; }
    .question img { width:300px; display:block; margin:10px 0; }
    .answer { background: #eee; padding: 8px; margin: 5px 0; border-radius: 5px; cursor: pointer; }
    .answer.selected { background: var(--primary); color: #fff; }
    .explanation { background: #f8f9fa; border-left: 4px solid var(--info); padding: 10px; margin-top: 10px; display: none; }
    .navigation { text-align: center; margin-top: 10px; }
    .result-item { padding: 10px; border-radius: 5px; margin-bottom: 10px; }
    .result-item.correct { background: #e0f9e0; }
    .result-item.incorrect { background: #f9e0e0; }
    /* Loader */
    #loader { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; z-index: 2000; }
    .spinner { border: 6px solid #ccc; border-top: 6px solid var(--primary); border-radius: 50%; width:40px; height:40px; animation: spin 1s linear infinite; margin:0 auto 10px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    /* Modal */
    .modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index:1000; }
    .modal-content { background: #fff; padding: 20px; border-radius: 10px; text-align: center; width:300px; }
  </style>
</head>
<body>
<!-- Loader -->
<div id="loader">
  <div class="spinner"></div>
  <p>Загрузка...</p>
</div>
<header>
  <div class="container">
    <h1>Демо тест автошколы</h1>
  </div>
</header>
<div class="container" id="main-container">
  <!-- Добавлен id="modeSelection" для скрытия выбора режима -->
  <div class="mode-selection" id="modeSelection">
    <button id="trainingBtn" class="btn btn-primary">Режим обучения</button>
    <button id="examBtn" class="btn btn-primary">Режим экзамена</button>
  </div>
  <!-- Test Area -->
  <div id="testArea" class="card" style="display:none;">
    <div id="questionNav"></div>
    <div id="questionContainer" class="question">
      <h2 id="questionText"></h2>
      <img id="questionImage" src="" alt="" style="display:none;">
      <div id="answers"></div>
      <div id="explanation" class="explanation"></div>
      <button id="hintBtn" class="btn btn-info">Подсказка</button>
    </div>
    <div class="navigation">
      <button id="prevBtn" class="btn btn-primary">Назад</button>
      <button id="nextBtn" class="btn btn-primary">Дальше</button>
    </div>
    <button id="finishBtn" class="btn btn-danger" style="display:none;">Завершить тест</button>
    <button id="backBtn" class="btn btn-primary" style="display:none;">Вернуться к режимам</button>
  </div>
  <!-- Results Area -->
  <div id="resultsArea" class="card" style="display:none;">
    <h2>Результаты</h2>
    <div id="results"></div>
    <button id="backToMode" class="btn btn-primary">Вернуться к режимам</button>
  </div>
</div>
<!-- Modal -->
<div id="modal" class="modal" style="display:none;">
  <div class="modal-content">
    <p>Не все вопросы отвечены. Завершить тест?</p>
    <button id="modalYes" class="btn btn-success">Да</button>
    <button id="modalNo" class="btn btn-danger">Нет</button>
  </div>
</div>
<script>
  // Демонстрационные данные
  const questionsDemo = [
    { questionText: "Какой цвет светофора означает 'Стоп'?", options: ["Зеленый", "Красный", "Желтый"], correct: 2, explanation:"Красный сигнал предписывает остановку.", image:"" },
    { questionText: "Что означает знак 'Уступи дорогу'?", options: ["Проехать", "Остановиться", "Уступить"], correct: 3, explanation:"Требуется уступить дорогу.", image:"" }
  ];
  let currentMode = "", currentQuestion = 0, userAnswers = {};
  // Функции загрузчика
  function showLoader() {
    document.getElementById('loader').style.display = 'block';
    document.getElementById('main-container').classList.add('blur');
  }
  function hideLoader() {
    document.getElementById('loader').style.display = 'none';
    document.getElementById('main-container').classList.remove('blur');
  }
  // Отображение вопроса
  function renderQuestion() {
    const q = questionsDemo[currentQuestion];
    document.getElementById('questionText').textContent = q.questionText;
    const img = document.getElementById('questionImage');
    img.style.display = 'none';
    img.src = q.image || "";
    const answersDiv = document.getElementById('answers');
    answersDiv.innerHTML = "";
    q.options.forEach((opt, i) => {
      const div = document.createElement('div');
      div.textContent = opt;
      div.className = "answer" + (userAnswers[currentQuestion]===i+1 ? " selected" : "");
      div.addEventListener('click', () => {
        userAnswers[currentQuestion] = i+1;
        renderQuestion();
        if(currentMode==="training" && i+1===q.correct){
          let prev = currentQuestion;
          setTimeout(()=>{ if(prev===currentQuestion && currentQuestion < questionsDemo.length-1) { currentQuestion++; renderQuestion(); } }, 1000);
        } else if(currentMode==="training" && i+1!==q.correct){
          const exp = document.getElementById('explanation');
          exp.innerHTML = `<strong>Правильный ответ: ${q.options[q.correct-1]}</strong><br><br>${q.explanation}`;
          exp.style.display = 'block';
        }
      });
      answersDiv.appendChild(div);
    });
    document.getElementById('questionNav').textContent = `Вопрос ${currentQuestion+1} из ${questionsDemo.length}`;
    document.getElementById('explanation').style.display = 'none';
  }
  // Режимы
  document.getElementById('trainingBtn').addEventListener('click', () => {
    currentMode = "training"; currentQuestion = 0; userAnswers = {};
    document.getElementById('modeSelection').style.display = 'none';
    document.getElementById('testArea').style.display = 'block';
    document.getElementById('finishBtn').style.display = 'none';
    document.getElementById('backBtn').style.display = 'block';
    renderQuestion();
  });
  document.getElementById('examBtn').addEventListener('click', () => {
    currentMode = "exam"; currentQuestion = 0; userAnswers = {};
    document.getElementById('modeSelection').style.display = 'none';
    document.getElementById('testArea').style.display = 'block';
    document.getElementById('finishBtn').style.display = 'block';
    document.getElementById('backBtn').style.display = 'none';
    renderQuestion();
  });
  document.getElementById('prevBtn').addEventListener('click', () => { if(currentQuestion>0){ currentQuestion--; renderQuestion(); }});
  document.getElementById('nextBtn').addEventListener('click', () => { if(currentQuestion < questionsDemo.length-1){ currentQuestion++; renderQuestion(); }});
  document.getElementById('hintBtn').addEventListener('click', ()=> {
    const q = questionsDemo[currentQuestion];
    const exp = document.getElementById('explanation');
    if(exp.style.display==='none'){
      exp.innerHTML = `<strong>Правильный ответ: ${q.options[q.correct-1]}</strong><br><br>${q.explanation}`;
      exp.style.display='block';
    } else { exp.style.display='none'; }
  });
  document.getElementById('finishBtn').addEventListener('click', ()=>{
    if(currentMode==="exam" && Object.keys(userAnswers).length < questionsDemo.length){
      if(!confirm("Не все вопросы отвечены. Завершить тест?")) return;
    }
    showResults();
  });
  function showResults(){
    document.getElementById('testArea').style.display = 'none';
    const resDiv = document.getElementById('results');
    resDiv.innerHTML = "";
    let correct = 0;
    questionsDemo.forEach((q, i)=>{
      const userAns = userAnswers[i];
      const isCorr = userAns===q.correct;
      if(isCorr) correct++;
      const div = document.createElement('div');
      div.className = "result-item " + (isCorr ? "correct" : "incorrect");
      div.innerHTML = `<h4>Вопрос ${i+1}: ${isCorr ? "✓" : "✗"}</h4>
                         <p>${q.questionText}</p>
                         <img src="${q.image||""}" alt="" style="width:300px; margin:10px 0;" onerror="this.style.display='none'">
                         <p>Ваш ответ: ${userAns ? q.options[userAns-1] : "Не отвечено"}</p>
                         ${!isCorr ? `<p>Правильный ответ: ${q.options[q.correct-1]}</p>` : ""}`;
      resDiv.appendChild(div);
    });
    document.getElementById('resultsArea').style.display = 'block';
  }
  document.getElementById('backBtn').addEventListener('click', backToModes);
  document.getElementById('backToMode').addEventListener('click', backToModes);
  function backToModes(){
    document.getElementById('testArea').style.display = 'none';
    document.getElementById('resultsArea').style.display = 'none';
    document.getElementById('modeSelection').style.display = 'block';
  }
</script>
</body>
</html>
